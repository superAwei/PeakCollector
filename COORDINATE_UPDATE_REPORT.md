# 📍 台灣百岳座標精確度更新報告

**更新日期**：2024-12-08
**更新版本**：v1.1.0

---

## 📊 更新摘要

本次更新針對台灣百岳座標精確度進行了全面檢查與修正，並新增座標來源標注系統。

### 主要變更

| 項目 | 更新前 | 更新後 | 狀態 |
|------|--------|--------|------|
| Peak 介面 | 7個欄位 | **8個欄位** | ✅ 新增 `coordinateSource` |
| 前10座座標 | 參考值 | **PeakVisor 官方資料** | ✅ 已修正 |
| 座標來源標注 | 無 | **100% 完整標注** | ✅ 完成 |
| 測試檔案 | 舊座標 | **精確座標** | ✅ 已更新 |

---

## 🎯 座標精確度分級

### 座標來源說明

```typescript
export interface Peak {
  coordinateSource?: 'official' | 'peakvisor' | 'reference' | 'estimated';
}
```

| 等級 | 來源 | 數量 | 精確度 | 說明 |
|------|------|------|--------|------|
| `official` | 內政部國土測繪中心 | 0 座 | ⭐⭐⭐⭐⭐ | 官方測量資料（目前無法取得） |
| `peakvisor` | PeakVisor 官方資料庫 | **10 座** | ⭐⭐⭐⭐ | 國際登山資料庫，精確度高 |
| `reference` | 參考資料整理 | **10 座** | ⭐⭐⭐ | 來自登山團體、健行筆記等 |
| `estimated` | 估計值 | **80 座** | ⭐⭐ | 未經官方驗證，僅供參考 |

---

## 🔍 前10座百岳座標修正詳情

### 修正前後對比

| 排名 | 山名 | 修正前緯度 | 修正後緯度 | 修正前經度 | 修正後經度 | 誤差距離 |
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| 1 | 玉山 | 23.47 | 23.47 | 120.957 | **120.9572** | ~22m |
| 2 | 雪山 | 24.3895 | **24.3832** | 121.2342 | **121.2317** | ~700m |
| 3 | 玉山東峰 | 23.4742 | **23.4706** | 120.9628 | **120.965** | ~400m |
| 4 | 秀姑巒山 | 23.4561 | **23.4967** | 121.0192 | **121.0572** | ~5.2km ⚠️ |
| 5 | 玉山北峰 | 23.4836 | **23.4872** | 120.9553 | **120.9594** | ~450m |
| 6 | 玉山南峰 | 23.4589 | **23.4464** | 120.9547 | **120.9586** | ~1.4km |
| 7 | 馬博拉斯山 | 23.5153 | **23.5203** | 121.0411 | **121.0669** | ~2.6km ⚠️ |
| 8 | 南湖大山 | 24.3647 | **24.3617** | 121.4322 | **121.4392** | ~700m |
| 9 | 東小南山 | 23.4653 | **23.4389** | 121.0175 | **120.9633** | ~5.8km ⚠️ |
| 10 | 中央尖山 | 24.3883 | **24.31** | 121.4225 | **121.4161** | ~8.7km ⚠️ |

⚠️ **重要發現**：第4、7、9、10名的原始座標誤差超過1公里，可能導致驗證失敗！

### 海拔高度修正

| 山名 | 修正前 | 修正後 | 差異 |
|:---:|:---:|:---:|:---:|
| 秀姑巒山 | 3825m | **3860m** | +35m |
| 馬博拉斯山 | 3765m | **3805m** | +40m |

---

## 📁 更新檔案清單

### 核心資料檔案

- ✅ `lib/peaks-data.ts`
  - 新增 `coordinateSource` 欄位到 Peak 介面
  - 修正前10座百岳的精確座標
  - 為所有100座添加座標來源標注
  - 新增註釋說明座標來源

### 測試檔案

- ✅ `public/test-yushan.gpx`
  - 更新玉山主峰座標：120.957 → 120.9572

- ✅ `public/test-multiple.gpx`
  - 更新玉山主峰座標：23.4701, 120.9571 → 23.4700, 120.9572
  - 更新玉山東峰座標：23.4743, 120.9629 → 23.4706, 120.9650
  - 更新玉山北峰座標：23.4837, 120.9554 → 23.4872, 120.9594

---

## 🔬 資料來源

### PeakVisor 官方資料庫（前10座）

來源：https://peakvisor.com/list/100-peaks-of-taiwan.html

**可靠度**：⭐⭐⭐⭐ (4/5)
- 國際知名登山資料庫
- 定期更新座標資訊
- 與多國測繪機構合作
- 已被全球登山社群廣泛使用

### 參考資料（第11-20座）

來源：
- 台灣百岳俱樂部
- 健行筆記
- 上河文化地圖

**可靠度**：⭐⭐⭐ (3/5)
- 登山團體實測資料
- 可能存在測量誤差
- 建議上傳真實 GPX 軌跡驗證

### 估計值（第21-100座）

來源：手動編譯、地圖標示

**可靠度**：⭐⭐ (2/5)
- ⚠️ **未經官方驗證**
- 僅供參考使用
- **強烈建議**使用者上傳真實 GPX 軌跡進行驗證

---

## ⚙️ GPX 驗證邏輯

### 驗證範圍

```typescript
export function verifyPeakVisit(
  gpxData: GPXData,
  peak: Peak,
  threshold: number = 100 // 100公尺範圍內視為登頂
): boolean
```

### 為什麼是 100 公尺？

1. **GPS 精確度**：一般登山 GPS 設備精確度為 5-20 公尺
2. **山頂範圍**：實際山頂並非精確點位，而是一個區域
3. **座標誤差**：部分百岳座標可能存在測量誤差
4. **安全邊際**：100 公尺範圍可容納合理的誤差

### 驗證流程

```
1. 讀取 GPX 檔案中的所有軌跡點
2. 使用 Haversine 公式計算每個軌跡點到山頂的距離
3. 如果任一軌跡點距離 ≤ 100m，判定為登頂成功
4. 將成功登頂的百岳 ID 儲存至 localStorage
```

---

## 📈 精確度改進建議

### 短期（1-3個月）

1. **收集用戶 GPX 資料**
   - 邀請登山者上傳真實軌跡
   - 分析多筆軌跡的平均座標
   - 修正誤差較大的山峰

2. **整合官方資料**
   - 向內政部國土測繪中心申請三角點座標
   - 與台灣百岳俱樂部合作取得驗證資料

3. **建立回報機制**
   - 允許用戶回報座標錯誤
   - 收集社群反饋進行修正

### 長期（3-12個月）

1. **機器學習優化**
   - 分析數千筆真實 GPX 軌跡
   - 使用機器學習模型預測精確座標

2. **即時更新系統**
   - 建立座標資料庫 API
   - 定期更新最新測量資料

3. **多來源驗證**
   - 整合 Google Maps、OSM 等多個地圖來源
   - 交叉驗證提高精確度

---

## 🧪 測試驗證

### 測試環境

- ✅ Next.js 16.0.7 開發伺服器正常運行
- ✅ Turbopack 編譯成功，無錯誤
- ✅ TypeScript 類型檢查通過
- ✅ 所有100座百岳資料完整載入

### 建議測試步驟

1. **啟動開發伺服器**
   ```bash
   npm run dev
   ```

2. **上傳測試檔案**
   - 上傳 `public/test-yushan.gpx` → 應驗證成功：玉山主峰
   - 上傳 `public/test-multiple.gpx` → 應驗證成功：玉山、玉山東峰、玉山北峰

3. **檢查徽章牆**
   - 確認對應的百岳徽章點亮
   - 檢查進度統計是否正確更新

4. **測試 localStorage**
   - 開啟瀏覽器 DevTools
   - 檢查 `localStorage.getItem('peak-collector-completed-peaks')`
   - 確認已驗證的百岳 ID 正確儲存

---

## ⚠️ 已知限制與風險

### 座標精確度風險

1. **第21-100座精確度較低**
   - 僅為參考值，未經官方驗證
   - 可能導致真實登頂無法驗證成功
   - **建議**：使用者可手動標記完成

2. **部分山峰誤差過大**
   - 東小南山、中央尖山等誤差超過5公里
   - **急需**真實 GPX 資料修正

3. **不同測量系統差異**
   - WGS84、TWD97 等座標系統轉換誤差
   - 地圖標示與實際山頂位置可能不同

### 解決方案

- 提供**手動驗證模式**（未來功能）
- 收集**群眾外包資料**優化座標
- 與**官方機構合作**取得精確資料

---

## 📞 技術細節

### 座標格式轉換

PeakVisor 提供的座標為度分秒（DMS）格式，已轉換為十進位格式：

```
度分秒格式：23°28′12″N, 120°57′26″E
十進位格式：23.47° N, 120.9572° E

轉換公式：
十進位度 = 度 + (分 / 60) + (秒 / 3600)
```

### Haversine 距離公式

```typescript
function haversineDistance(
  lat1: number, lon1: number,
  lat2: number, lon2: number
): number {
  const R = 6371000; // 地球半徑（公尺）
  const φ1 = lat1 * Math.PI / 180;
  const φ2 = lat2 * Math.PI / 180;
  const Δφ = (lat2 - lat1) * Math.PI / 180;
  const Δλ = (lon2 - lon1) * Math.PI / 180;

  const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
            Math.cos(φ1) * Math.cos(φ2) *
            Math.sin(Δλ/2) * Math.sin(Δλ/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

  return R * c; // 回傳距離（公尺）
}
```

---

## ✅ 總結

### 已完成

- ✅ 新增 `coordinateSource` 座標來源欄位
- ✅ 修正前10座百岳的精確座標（PeakVisor 官方資料）
- ✅ 為第11-20座標注參考資料來源
- ✅ 為第21-100座標注估計值來源
- ✅ 更新所有測試檔案
- ✅ 修正秀姑巒山、馬博拉斯山的海拔高度
- ✅ 編譯測試通過，無錯誤

### 待改進

- ⏳ 收集更多真實 GPX 軌跡資料
- ⏳ 向內政部申請官方三角點座標
- ⏳ 建立用戶回報座標錯誤機制
- ⏳ 新增手動驗證模式（供座標不精確時使用）

### 建議

**對於登山者**：
- 前10座百岳可放心使用 GPX 自動驗證
- 第11-100座建議上傳真實軌跡測試，如有問題可手動記錄

**對於開發者**：
- 持續收集用戶 GPX 資料優化座標
- 考慮整合多個地圖 API 交叉驗證
- 建立座標精確度視覺化指標

---

<div align="center">

**🏔️ 讓我們一起完成台灣百岳！**

Made with ❤️ for Taiwan hikers

</div>
